#!/bin/sh
#
# Start the network....
#

# Debian ifupdown needs the /run/network lock directory
if [ -e "/sys/class/net/eth0" ]; then
  mkdir -p /run/network

  case "$1" in
    start)
	  printf "Starting network: "
	  /sbin/ifup -a
          bootproto=$(cat /etc/network/ifcfg-eth0|grep BOOTPROTO=|sed 's/BOOTPROTO=//')
          if [ $bootproto = static ];then
            ip=$(cat /etc/network/ifcfg-eth0|grep IPADDR=|sed 's/IPADDR=//')
            netmask=$(cat /etc/network/ifcfg-eth0|grep NETMASK=|sed 's/NETMASK=//')
            gateway=$(cat /etc/network/ifcfg-eth0|grep GATEWAY=|sed 's/GATEWAY=//')
            /sbin/ifconfig eth0 $ip netmask $netmask up
            /sbin/route add default gw $gateway
            echo "nameserver 8.8.8.8" > /etc/resolv.conf
          else
            /sbin/udhcpc -b -i eth0 -R &
          fi
	  [ $? = 0 ] && echo "OK" || echo "FAIL"
	  ;;
    stop)
	  printf "Stopping network: "
	  /sbin/ifdown -a
	  [ $? = 0 ] && echo "OK" || echo "FAIL"
	  ;;
    restart|reload)
	  "$0" stop
	  "$0" start
	  ;;
    *)
	  echo "Usage: $0 {start|stop|restart}"
	  exit 1
esac
fi
exit $?

